<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>stb-tester release notes</title>
  <link href="stb-tester.css" media="all" rel="stylesheet" type="text/css" />

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34036034-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</head>

<body id="release-notes">

<div id="header">
  <h1>stb-tester release notes</h1>
</div>

<div id="content">

<p><a class="reference external" href="http://stb-tester.com">stb-tester</a> is in &quot;beta&quot; stage, in the sense that
interfaces may change from one release to the next, though stb-tester <em>is</em> used
in production by several companies so we do try to minimise incompatible
changes. The release notes always provide an exhaustive list of any changes.</p>
<div class="section" id="support-for-redrat-irnetbox-ii-improved-robustness-after-video-loss-improved-exception-output">
<h2 id="0.11">0.11 Support for RedRat irNetBox-II; improved robustness after video loss; improved exception output</h2>
<p>27 Feb 2013.</p>
<p>The RedRat irNetBox is a rack-mountable network-controlled infrared
emitter. This release adds support for the irNetBox model II; previously
only model III was supported. Thanks to Emmett Kelly for the patch.</p>
<p>The first <cite>wait_for_match</cite> after restarting pipeline (due to video loss)
now obeys <cite>timeout_secs</cite>. Due to a bug, the total timeout in this
situation used to be the specified <cite>timeout_secs</cite> plus the time the
script had spent running so far (possibly many minutes!). See commit
<a class="reference external" href="https://github.com/drothlis/stb-tester/commit/cf57a4c2">cf57a4c2</a> for
details.</p>
<p>Fixed bug observed with Blackmagic Intensity Pro video capture cards,
where restarting the pipeline (after momentary video loss) caused the
card to stop delivering timestamps in the video frames, causing <cite>stbt
run</cite> to hang. See commit
<a class="reference external" href="https://github.com/drothlis/stb-tester/commit/53d5ecf3">53d5ecf3</a>
for details.</p>
<p><cite>stbt run</cite> now prints an exception's name &amp; message, not just the stack
trace. Since version 0.10, <cite>stbt</cite> wasn't printing this information for
non-<cite>MatchTimeout</cite> exceptions.</p>
</div>
<div class="section" id="fix-irnetbox-connection-retry">
<h2 id="0.10.1">0.10.1 Fix irNetBox connection retry</h2>
<p>14 Feb 2013.</p>
<p>Release 0.10 was supposed to fix the irNetBox connection retry on Linux,
but in fact broke it for everyone. This release fixes that, and also
adds static analysis to &quot;make check&quot; so that this type of error doesn't
happen again.</p>
</div>
<div class="section" id="fix-irnetbox-connection-retry-on-linux-other-minor-fixes">
<h2 id="0.10">0.10 Fix irNetBox connection retry on Linux; other minor fixes</h2>
<p>11 Feb 2013.</p>
<p>The irNetBox device only allows one TCP connection at a time, so when
multiple stbt tests are using the same irNetBox simultaneously, clashes
are inevitable. <cite>stbt run</cite> was supposed to retry refused connections,
but this was not working on Linux due to non-portable assumptions about
error numbers.</p>
<p><cite>stbt run</cite> now saves a screenshot to disk for any exception with a
<cite>screenshot</cite> attribute, not just <cite>stbt.MatchTimeout</cite>.</p>
<p>The script generated by <cite>stbt record</cite> qualifies commands with <cite>stbt.</cite>
module, just to nudge people towards this best practice. In future we
might stop <cite>stbt run</cite> from implicitly importing <cite>wait_for_match</cite> etc.
into the top-level namespace, but for now the only change is to what
<cite>stbt record</cite> produces.</p>
<p>Other minor fixes:</p>
<blockquote>
<ul class="simple">
<li>Better build system error messages.</li>
<li>Minor fixes to the bash tab-completion script.</li>
</ul>
</blockquote>
</div>
<div class="section" id="support-for-redrat-irnetbox-wait-for-motion-more-tolerant-to-noise">
<h2 id="0.9">0.9 Support for RedRat irNetBox; <cite>wait_for_motion</cite> more tolerant to noise</h2>
<p>7 Jan 2013.</p>
<p>The <a class="reference external" href="http://www.redrat.co.uk/products/irnetbox.html">RedRat irNetBox-III</a> is
a rack-mountable network-controlled infrared emitter with 16 separate outputs
and adjustable power levels to avoid infrared interference between the
systems-under-test. For further information see the <cite>--control=irnetbox</cite>
configuration in the
<a class="reference external" href="http://stb-tester.com/stbt.html#global-options">stbt man page</a>,
and commit messages
<a class="reference external" href="https://github.com/drothlis/stb-tester/commit/508941e">508941e</a> and
<a class="reference external" href="https://github.com/drothlis/stb-tester/commit/778d847">778d847</a>.
Many thanks to Chris Dodge at RedRat for the donation of irNetBox hardware to
the stb-tester project and of his time in answering questions.</p>
<p><cite>wait_for_motion</cite> now takes a
<a class="reference external" href="http://stb-tester.com/stbt.html#wait_for_motion">noise_threshold</a> parameter;
decrease <cite>noise_threshold</cite> to avoid false positives when dealing with noisy
analogue video sources.
Thanks to Emmett Kelly for the patch!</p>
<p>Other minor changes:</p>
<blockquote>
<ul class="simple">
<li>The remote control implementations of <cite>stbt.press</cite> (Lirc,
VirtualRemote, irNetBox) try to re-connect if the connection (to
lircd, to the set-top box, to the irNetBox, respectively) had been
dropped.</li>
<li>Build/packaging fix: Always rebuild <cite>stbt</cite> (which reports the version
with <cite>stbt --version</cite>) when the version changes.</li>
<li>Minor fixes to the tab-completion script, self-tests and
documentation.</li>
</ul>
</blockquote>
</div>
<div class="section" id="bugfixes-wait-for-match-returns-the-matchresult-adds-get-frame-save-frame-debug">
<h2 id="0.8">0.8 Bugfixes; <cite>wait_for_match</cite> returns the <cite>MatchResult</cite>; adds <cite>get_frame</cite>, <cite>save_frame</cite>, <cite>debug</cite></h2>
<p>21 Nov 2012.</p>
<p><cite>wait_for_match</cite> and <cite>press_until_match</cite> now return the <cite>MatchResult</cite> object
for successful matches, and <cite>wait_for_motion</cite> returns the <cite>MotionResult</cite>. See
commit <a class="reference external" href="https://github.com/drothlis/stb-tester/commit/540476ff">540476ff</a> for
details.</p>
<p>New functions <cite>get_frame</cite> and <cite>save_frame</cite> allow capturing screenshots
at arbitrary points in the user's script. New function <cite>debug</cite> allows
user's scripts to print output only when stbt run &quot;--verbose&quot; was given.
Also documented the (existing) exception hierarchy in the README /
man-page.</p>
<p>Bugfixes:</p>
<blockquote>
<ul class="simple">
<li>Fixes a deadlock (introduced in 0.7) after GStreamer errors or video
loss from the system under test.</li>
<li>Improves GStreamer pipeline restarting after transient video loss (see
commit <a class="reference external" href="https://github.com/drothlis/stb-tester/commit/2c434b2d">2c434b2d</a> for details).</li>
<li>Fixes segfault in <cite>stbt-motiondetect</cite> GStreamer element when
<cite>debugDirectory</cite> enabled with no mask.</li>
</ul>
</blockquote>
<p>Other minor changes:</p>
<blockquote>
<ul class="simple">
<li>The selftests now work correctly on OS X.</li>
<li><cite>make install</cite> will rebuild <cite>stbt</cite> if given a different <cite>prefix</cite>
directory than the <cite>prefix</cite> given to <cite>make stbt</cite>.</li>
</ul>
</blockquote>
</div>
<div class="section" id="exposes-detect-match-and-detect-motion-removes-directory-argument-changes-image-search-path">
<h2 id="0.7">0.7 Exposes <cite>detect_match</cite> and <cite>detect_motion</cite>; removes <cite>directory</cite> argument, changes image search path</h2>
<p>21 October 2012.</p>
<p>New functions <cite>detect_match</cite> and <cite>detect_motion</cite> provide low-level
access to all the information provided by the <cite>stbt-templatematch</cite> and
<cite>stbt-motiondetect</cite> GStreamer elements for each frame of video processed.
To keep your test scripts readable, I recommend against using
<cite>detect_match</cite> and <cite>detect_motion</cite> directly; they are intended for you
to write helper functions that you can then use in your scripts. For an
example see <cite>wait_for_match</cite> and <cite>wait_for_motion</cite> in stbt.py: They are
now implemented in terms of <cite>detect_match</cite> and <cite>detect_motion</cite>.</p>
<p><cite>wait_for_match</cite>, <cite>press_until_match</cite> and <cite>wait_for_motion</cite> no longer
accept the optional <cite>directory</cite> argument. In most cases the correct
upgrade path is simply to not give the <cite>directory</cite> argument from your
scripts. These functions (plus <cite>detect_match</cite> and <cite>detect_motion</cite>) now
search for specified template or mask images by looking in their
caller's directory, then their caller's caller's directory, etc.
(instead of looking only in their immediate caller's directory, or the
directory specified as an argument). This allows you to write helper
functions that take an image filename and then call <cite>wait_for_match</cite>.
See commit message
<a class="reference external" href="https://github.com/drothlis/stb-tester/commit/4e5cd23c">4e5cd23c</a>
for details.</p>
<p>Bugfixes and minor changes:</p>
<blockquote>
<ul class="simple">
<li><cite>stbt run</cite> no longer requires an X-Windows display (unless you're
using an X-Windows sink in your pipeline).</li>
<li>wait_for_motion and detect_motion visualisation: Detected motion is
highlighted in red in the output video, and masked-out portions of
the frame are darkened.</li>
<li>Additional wait_for_motion logging with <cite>stbt run -vv</cite>.</li>
<li>wait_for_motion fails immediately if a mask is given but not found
on the filesystem.</li>
<li>Send an end-of-stream event in the pipeline teardown; this avoids
corrupted videos when using a source or sink pipeline that records
video to disk.</li>
<li>Reset wait_for_match after it fails. (If the user's script caught the
MatchTimeout exception and continued, the stbt-templatematch element
used to remain active, consuming CPU and showing the search rectangle
on the output video.) Same fix for wait_for_motion, detect_motion,
etc.</li>
<li><cite>stbt record</cite> now accepts <cite>-v</cite> (or <cite>--verbose</cite>) command-line option
(<cite>stbt run</cite> already did).</li>
<li><cite>stbt run</cite> throws exceptions for all error conditions (instead of
exiting with <cite>sys.exit(1)</cite> in some cases).</li>
<li><cite>stbt run</cite> exposes the following exceptions directly in the script's
namespace (so the script can say <cite>except MatchTimeout</cite> instead of
<cite>import stbt; except stbt.MatchTimeout</cite>): UITestError, UITestFailure,
MatchTimeout, MotionTimeout, ConfigurationError.</li>
<li>All functions and classes exposed to user scripts are now fully
documented in the man page.</li>
<li>Fixes to the self-tests: <cite>test_record</cite> wasn't reporting failures;
<cite>test_wait_for_match_nonexistent_{template,match}</cite> were failing
intermittently.</li>
<li>RPM spec file in extras/</li>
</ul>
</blockquote>
</div>
<div class="section" id="improves-templatematch-adds-verbose-flag-certainty-renamed-to-noise-threshold">
<h2 id="0.6">0.6 Improves templatematch, adds <cite>--verbose</cite> flag, <cite>certainty</cite> renamed to <cite>noise_threshold</cite></h2>
<p>5 September 2012.</p>
<p>The templatematch algorithm is more precise (see commit
<a class="reference external" href="https://github.com/drothlis/stb-tester/commit/ee28b8e">ee28b8e</a> for
details). Taking advantage of this, <cite>wait_for_match</cite> now waits by
default for only one match.</p>
<p>The optional parameter <cite>certainty</cite> of <cite>wait_for_match</cite> and
<cite>press_until_match</cite> has been removed. Since 0.4 it actually didn't have
any effect. It has been replaced with the parameter <cite>noise_threshold</cite>,
a floating-point value between 0 and 1 that defaults to 0.16. Increase
it to be more tolerant to noise (small differences between the desired
template and the source video frame).</p>
<p>Debug output is disabled by default; use <cite>--verbose</cite> or <cite>-v</cite> to enable.
Use <cite>-v -v</cite> (or <cite>-vv</cite>) to enable additional debug, including dumping of
intermediate images by the stbt-templatematch and stbt-motiondetect
GStreamer elements (this is extremely verbose, and isn't intended for
end users).</p>
<p>libgst-stb-tester.so's <cite>stbt-templatematch</cite> element can now be installed
alongside libgstopencv.so's <cite>templatematch</cite> element.</p>
<p>MatchTimeout is reported correctly if the GStreamer pipeline failed to
start due to a v4l2 error (even better would be to detect the v4l2 error
itself).</p>
<p>Limit the maximum attempts to restart the pipeline in case of underrun
(e.g. on loss of input video signal). Previously, <cite>stbt run</cite> attempted
to restart the pipeline infinitely.</p>
<p>Fix <cite>make install</cite> with Ubuntu's shell (dash).</p>
<p>Other non-user-visible and trivial changes since 0.5:</p>
<ul class="simple">
<li>stbt-templatematch bus message's parameter <cite>result</cite> is renamed to
<cite>match</cite> and is now a boolean.</li>
<li><cite>make check</cite> returns the correct exit status for failing self-tests.</li>
<li>The bash-completion script completes the <cite>--help</cite> flag.</li>
<li>Fix &quot;unknown property debugDirectory&quot; warning from
<cite>stbt-templatematch</cite> element.</li>
</ul>
</div>
<div class="section" id="make-install-installs-stbt-run-record-py-into-libexecdir">
<h2 id="0.5">0.5 <cite>make install</cite> installs stbt{-run,-record,.py} into $libexecdir</h2>
<p>14 August 2012.</p>
<p>The only difference from 0.4 is this change to install locations,
for the benefit of packagers.</p>
</div>
<div class="section" id="adds-gstreamer-plugin-improved-templatematch-motion-detection">
<h2 id="0.4">0.4 Adds gstreamer plugin, improved templatematch, motion detection</h2>
<p>14 August 2012.</p>
<p>New &quot;libgst-stb-tester.so&quot; gstreamer plugin with stbt-templatematch
(copied from gst-plugins-bad and improved) and stbt-motiondetect
elements.</p>
<p>stbt scripts can use &quot;wait_for_motion&quot; to assert that video is playing.
&quot;wait_for_motion&quot; takes an optional &quot;mask&quot; parameter (a black-and-white
image where white pixels indicate the regions to check for motion).</p>
<p>The improved templatematch is more robust in the presence of noise, and
can detect small but significant changes against large template images.</p>
<p>Other changes since 0.3:</p>
<ul class="simple">
<li>Bash-completion script for stbt.</li>
<li>stbt no longer reads configuration from $PWD/stbt.conf.</li>
<li>extra/jenkins-stbt-run is a shell script that illustrates how to use
Jenkins (a continuous-integration system with a web interface) to
schedule stbt tests and report on their results. See commit message
<a class="reference external" href="https://github.com/drothlis/stb-tester/commit/d5e7983">d5e7983</a>
for instructions.</li>
</ul>
</div>
<div class="section" id="fixes-stbt-run-freezing-on-loss-of-input-video">
<h2 id="0.3">0.3 Fixes <cite>stbt run</cite> freezing on loss of input video.</h2>
<p>24 July 2012.</p>
<p>You will still see the blue screen when input video cuts out, but now
<cite>stbt run</cite> should recover after 5 - 10 seconds and continue running the
test script.</p>
<p>Other changes since 0.2:</p>
<ul class="simple">
<li>Fix VirtualRemote recorder.</li>
<li>Clearer error messages on VirtualRemote failure to connect.</li>
<li>Added <cite>certainty</cite> optional argument to <cite>press_until_match</cite>
(<cite>wait_for_match</cite> already takes <cite>certainty</cite>).</li>
<li><cite>man stbt</cite> documents the optional arguments to <cite>wait_for_match</cite> and
<cite>press_until_match</cite>.</li>
</ul>
</div>
<div class="section" id="adds-configurability-ir-blaster-support">
<h2 id="0.2">0.2 Adds configurability, IR blaster support.</h2>
<p>6 July 2012.</p>
<p>Major changes since 0.1.1:</p>
<ul class="simple">
<li>The source &amp; sink gstreamer pipelines, the input &amp; output remote control,
and the input &amp; output script filename, are all configurable.</li>
<li>Support for LIRC-based infrared emitter &amp; receiver hardware.</li>
<li>Handle gstreamer errors.</li>
<li>Automated self-tests.</li>
</ul>
</div>
<div class="section" id="initial-internal-release-with-packaging-fixes">
<h2 id="0.1.1">0.1.1 Initial internal release, with packaging fixes.</h2>
<p>21 June 2012.</p>
<p>The difference from 0.1 is that <cite>make install</cite> now works correctly from
a dist tarball.</p>
</div>
<div class="section" id="initial-internal-release">
<h2 id="0.1">0.1 Initial internal release.</h2>
<p>21 June 2012.</p>
</div>


</div>
</body>
</html>
