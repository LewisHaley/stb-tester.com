<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Using Jenkins to schedule &amp; report stb-tester scripts</title>
  <link href="stb-tester.css" media="all" rel="stylesheet" type="text/css" />

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34036034-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</head>

<!-- Copyright 2012 David Röthlisberger <david@rothlis.net>. All rights reserved. -->

<body id="jenkins">

<div id="header">
  <h1>Using Jenkins to schedule &amp; report stb-tester scripts</h1>
  <p id="about">
    By <a href="http://david.rothlis.net">David Röthlisberger</a>.
    Last updated 18 Sep 2012.
  </p>
</div>

<div id="content">

<p><a class="reference external" href="http://stb-tester.com">stb-tester</a> is an open-source command-line tool that runs automated tests
against a set-top box or similar device by capturing and analysing its video
output. <a class="reference external" href="http://jenkins-ci.org">Jenkins</a> is an open-source &quot;continuous integration&quot; tool with a web
interface. Jenkins is typically used to run software compilation jobs and
associated unit tests, but here we will use it to run stb-tester test scripts
and report on the results.</p>
<p>This article illustrates how easy it is to integrate stb-tester with an
external scheduling &amp; reporting system. Using Jenkins in this way will give you
a very useful, working solution in only a couple of hours; eventually you may
want more control over the test scheduling, or more customised reports, which
would require building your own system (perhaps as a Jenkins plugin, perhaps a
separate system).</p>
<div class="section" id="system-overview">
<h2>System overview</h2>
<object data="stb-tester+jenkins+setup.svg" type="image/svg+xml">
stb-tester+jenkins+setup.svg</object>
<p>The Jenkins server runs on the <strong>master</strong> PC, which is attached to one or more
Jenkins <strong>nodes</strong> or slaves. Each node is attached to one set-top box (the
<strong>system under test</strong>) via an infra-red emitter and a video-capture device. A
single PC can host multiple Jenkins nodes (we are currently running 4 nodes,
i.e. 4 video-capture devices + 4 set-top boxes, per PC).</p>
<p>Via the web interface you create a Jenkins <strong>job</strong> to run one or more
stb-tester scripts. The job can be configured to run on a specific node, or on
any available node that has been tagged with a particular label. The job can be
configured to run once (to be scheduled manually with a single click from the
Jenkins home page), or continuously.</p>
<p>The Jenkins master instructs the node to run the job; the node checks out the
source code repository containing the stb-tester scripts, runs the scripts with
<cite>stbt run</cite>, and writes the results into an xml file. The master then retrieves
the xml results and other artifacts of the test run from the node.</p>
<div class="figure container">
<img alt="jenkins+jobs.png" src="jenkins+jobs.png" />
<p>Jenkins jobs</p>
</div>
<p>Typically you would have several jobs running the same test (or set of tests)
against different software versions of the system under test (the current
production and development versions, at minimum). A &quot;sanity pack&quot; job might run
a small selection of your test scripts, and another &quot;soak test&quot; job might run
the same tests, plus others, over and over.</p>
<p>Node <strong>labels</strong> allow you to say things like &quot;run this job on any node
connected to a set-top box with software version x.y&quot; or, for tests that
require a specific broadcast input signal, &quot;on any node connected to a set-top
box with software version x.y <em>and</em> connected to a modulator&quot; (modulators are
expensive! And not every test requires one).</p>
<div class="figure container">
<img alt="jenkins+xunit+graph.png" src="jenkins+xunit+graph.png" />
<p>Jenkins test result graph</p>
</div>
<p>Jenkins displays <strong>test results</strong> for each run, and allows drilling down into
failing tests to view logs from standard output and standard error.</p>
<div class="fullwidth-figure container">
<img alt="jenkins+xunit+results.png" src="jenkins+xunit+results.png" />
<p>Jenkins test result details</p>
</div>
<div class="figure container">
<img alt="jenkins+artifacts.png" src="jenkins+artifacts.png" />
<p>Jenkins job artifacts</p>
</div>
<p>In addition to the above logs, Jenkins gathers any <strong>build artifacts</strong>
generated by the test run, as specified in the job configuration. These can
include custom logs, and screenshots and/or videos of the test run.</p>
</div>
<div class="section" id="detailed-instructions">
<h2>Detailed instructions</h2>
<p>I haven't finished writing the detailed instructions to configure the setup
described above; in the meantime, see the example script <a class="reference external" href="https://github.com/drothlis/stb-tester/blob/master/extra/jenkins-stbt-run">jenkins-stbt-run</a> to
be run on the Jenkins node, and the configuration instructions in <a class="reference external" href="https://github.com/drothlis/stb-tester/commit/d5e7983">this commit
message</a>.</p>
</div>


</div>

<div id="footer">
<p>
  This article copyright © 2012 <a href="http://david.rothlis.net">David
  Röthlisberger</a> and YouView TV Ltd.<br />
  Diagram by Will Manley.<br />
  Released under the <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free
  Documentation License</a>.
</p>
</div>

</body>
</html>
